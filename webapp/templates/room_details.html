<html>

<head>
    <title>Booking System</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8" /> {% load staticfiles %}
    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}" type="text/css" />
    <link rel="stylesheet" href="{% static 'css/style.css' %}" type="text/css" />
</head>

<body class="body">
    {% block navbar %} {% include "navbar.html" %} {% endblock %}
    <div class="container">
        <div id="row">
            <div class="col-md-6">
                <ul class="list-group">
                    {% for item in room_details %}
                    <li class="list-group-item inline">
                        <div class="row">
                            <label class="col-md-6" for="exampleInputEmail1">Name</label>
                            <div class="col-md-6"><span class="pull-right">{{ item.room_name }}</span></div>
                        </div>
                    </li>
                    <li class="list-group-item inline">
                        <div class="row">
                            <label class="col-md-6" for="exampleInputEmail1">Size</label>
                            <div class="col-md-6"><span class="pull-right">{{ item.room_size }}</span></div>
                        </div>
                    </li>
                    <li class="list-group-item inline">
                        <div class="row">
                            <label class="col-md-6" for="exampleInputEmail1">Location</label>
                            <div class="col-md-6"><span class="pull-right">{{ item.room_location }}</span></div>
                        </div>
                    </li>
                    <li class="list-group-item inline">
                        <div class="row">
                            <label class="col-md-6" for="exampleInputEmail1">Features</label>
                            <div class="col-md-6"><span class="pull-right">{{ item.room_features }}</span></div>
                        </div>
                    </li>
                    {% endfor %}
                </ul>
            </div>
            <div class="col-md-6">
                <form class="form-horizontal" method="POST" id="booking_details">
                    {% csrf_token %}
                    <div class="form-group has-feedback">
                        <label for="contact" class="col-sm-2 control-label">Contact</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" id="contact" name="contact">
                            <span class="glyphicon form-control-feedback" id="contact_error"></span>
                        </div>
                    </div>
                    <div class="form-group has-feedback">
                        <label for="description" class="col-sm-2 control-label">Description</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" id="description" name="description">
                            <span class="glyphicon form-control-feedback" id="description_error"></span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="inputPassword3" class="col-sm-2 control-label">Duration</label>
                        <div id="radio_btns" class="col-sm-10">
                            <div class="radio">
                                <label>
                                <input type="radio" value ="quarter" name="duration_radio" > 00:15
                            </label>
                            </div>
                            <div class="radio">
                                <label>
                                <input type="radio" value = "half" name="duration_radio" > 00:30
                            </label>
                            </div>
                            <div class="radio">
                                <label>
                                <input type="radio" value = "threequarter" name="duration_radio" > 00:45
                            </label>
                            </div>
                            <div class="radio">
                                <label>
                                <input type="radio" value = "onehour" name="duration_radio" > 01:00
                            </label>
                            </div>
                            <div class="radio inline">
                                <label>
                                <input type="radio" name="duration_radio" value = "userDuration">
                                <input type="text"  class="form-control" name = "durValue" id = "durValue" disabled>
                            </label>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-offset-2 col-sm-10">
                            <button id="book_button" type="submit" class="btn btn-default">Book</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div id="upcomingEvents"></div>
    <div id="showModal"></div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="{% static 'js/bootstrap.min.js' %}" type="text/javascript"></script>
    <script src="{% static 'js/request.js' %}" type="text/javascript"></script>
    <script src="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.15.0/jquery.validate.min.js" type="text/javascript"></script>
    <script type="text/javascript">
        $(document).ready(function() {
            $.ajax({
                type: "get",
                url: "/showWeek/",
                dataType: "html",
                success: function(data) {
                    $('#upcomingEvents').html(data);
                },
            });
            $.validator.addMethod("checkIfEmpty", function(value, element) {
                if ($('input[name=duration_radio]:checked').val() == "userDuration") {
                    var timeValue = $('input[name=durValue]').val();
                    if (timeValue == "") {
                        return false;
                    }
                }
                return true;
            }, "This field is required.");

            $.validator.addMethod("checkIfValidFormat", function(value, element) {
                if ($('input[name=duration_radio]:checked').val() == "userDuration") {
                    var timeValue = $('input[name=durValue]').val();
                    var regex = new RegExp('(1?[0-9]|2[0-3]):[0-5][0-9]');
                    if (regex.test(timeValue) == false) {
                        return false;
                    }
                }
                return true;
            }, "Invalid Format");
            $("#booking_details").validate({
                rules: {
                    'contact': {
                        required: true
                    },
                    'description': {
                        required: true
                    },
                    'duration_radio': {
                        required: true,
                        checkIfEmpty: true,
                        checkIfValidFormat: true,
                    },
                },
                highlight: function(element, errorClass, validClass) {
                    if (element.name == "duration_radio") {
                        $(element).closest('.form-group').addClass('has-error');
                    } else if (element.name == "durValue") {
                        $(element).closest('.form-group').addClass('has-error');
                    } else {
                        var error = "#" + $(element).attr("id") + "_error";
                        $(element).closest('.form-group').removeClass('has-success').addClass('has-error has-feedback');
                        $(error).addClass('glyphicon-remove');
                    }
                },
                unhighlight: function(element, errorClass, validClass) {
                    if (element.name == "duration_radio") {
                        //$(element).closest('.form-group').removeClass('has-error');
                        $(element).closest('.form-group').remove('span');
                    } else if (element.name == "durValue") {
                        if (validateTime(element.value)) {
                            $('input[name=durValue]:last').next().remove('span');
                        } else {
                            $('input[name=durValue]:last').next().remove('span');
                            var span = $('<span />').addClass('help-block').html("Invalid Format.");
                            span.css("color", "#a94442");
                            span.insertAfter($('input[name=durValue]:last'));
                        }
                    } else {
                        var error = "#" + $(element).attr("id") + "_error";
                        $(element).closest('.form-group').removeClass('has-error has-feedback');
                        $(error).removeClass('glyphicon-remove');
                    }
                },
                errorElement: 'span',
                errorClass: 'help-block',
                errorPlacement: function(error, element) {
                    if (element.attr("type") == "radio") {
                        error.insertAfter($('input[name=durValue]:last'));
                    } else {
                        if (element.parent('.input-group').length) {
                            error.insertAfter(element.parent());
                        } else {
                            error.insertAfter(element);
                        }
                    }
                },
            });
        });
    </script>
</body>

</html>