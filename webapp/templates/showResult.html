<div class="container">
    <div id="row">
        <div class="col-md-6">
            <ul class="list-group">
                <li class="list-group-item inline">
                    <div class="row">
                        <label class="col-md-6" for="exampleInputEmail1">Name</label>
                        <div class="col-md-6"><span class="pull-right">{{ room_name }}</span></div>
                    </div>
                </li>
                <li class="list-group-item inline">
                    <div class="row">
                        <label class="col-md-6" for="exampleInputEmail1">Size</label>
                        <div class="col-md-6"><span class="pull-right">{{ room_size }}</span></div>
                    </div>
                </li>
                <li class="list-group-item inline">
                    <div class="row">
                        <label class="col-md-6" for="exampleInputEmail1">Location</label>
                        <div class="col-md-6"><span class="pull-right">{{ room_location }}</span></div>
                    </div>
                </li>
                <li class="list-group-item inline">
                    <div class="row">
                        <label class="col-md-6" for="exampleInputEmail1">Features</label>
                        <div class="col-md-6"><span class="pull-right">{{ room_features }}</span></div>
                    </div>
                </li>
            </ul>
        </div>
        <div class="col-md-6">
            <form class="form-horizontal" method="POST" id="viewBooking">
                {% csrf_token %}
                <div class="form-group has-feedback">
                    <label for="contact" class="col-sm-2 control-label">Contact</label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" id="contact" name="contact" value={{ contact }}>
                        <span class="glyphicon form-control-feedback" id="contact_error"></span>
                    </div>
                </div>
                <div class="form-group has-feedback">
                    <label for="description" class="col-sm-2 control-label">Description</label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" id="description" name="description" value={{ description }}>
                        <span class="glyphicon form-control-feedback" id="description_error"></span>
                    </div>
                </div>
                <div class="form-group has-feedback">
                    <label for="duration" class="col-sm-2 control-label">Duration</label>
                    <div class="col-sm-10">
                        <input type="text" readonly class="form-control" id="duration" name="duration" value={{duration}}>
                        <span class="glyphicon form-control-feedback" id="duration_error"></span>
                    </div>
                </div>
                <div id = "additionalFields"></div>
                <div class="form-group">
                    <div class="col-sm-offset-2 col-sm-10">
                        <div class="btn-group" role="group" style="float: right;">
                            <button id="update" type="button" class="btn btn-default">Update</button>
                            <button id="cancelBooking" type="button" class="btn btn-default">Cancel</button>
                        </div>
                        <div class="btn-group" role="group" style="float: left;">
                            <button id="changeDuration" type="button" class="btn btn-default">Change Duration</button>
                            <button id="changeDateTime" type="button" class="btn btn-default">Change Date/Time</button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <div id="cancelBookingModal" class="modal fade">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button id = "exit1" type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
                    <h4 class="modal-title text-center">Cancel Booking</h4>
                </div>
                <div class="modal-body">
                    <p id = "modalText" align="center">Are you sure you want to cancel this booking</p>
                </div>
                <div class="modal-footer">
                    <button id = "cancelBooking2" type="button" class="btn btn-danger">Yes</button>
                    <button id = "exit" type="button" class="btn btn-default" data-dismiss="modal">No</button>
                </div>
                </form>
            </div>
        </div>
    </div>

</div>
<div id="showUpdateBKModal"></div>
<div id="CancelBookingModal"></div>
<script type="text/javascript">
    $('#cancelBooking').click(function(){
        $('#cancelBookingModal').modal('show');
    });
    
    $('#cancelBooking2').click(function(){
        var booking_id = $('input[name=booking_id]').val();
        var input = $input = $('<input type="text" name="booking_id" hidden/>').val(booking_id);
        $('#viewBooking').append(input);
        $.ajax({
            type: "POST",
             url: "/cancelBooking/",
             dataType: "html",
             data: $('#viewBooking').serialize(),
             success: function(data){
                $('#modalText').text(data);
                $('#cancelBooking2').remove();
                $('#exit').text('Close').button("refresh");
                $("[id='exit']").click(function() {
                    window.location = "/";
                });
                $("[id='exit1']").click(function() {
                    window.location = "/";
                });
             }
        });
    });

    $('#update').click(function() {
        var booking_id = $('input[name=booking_id]').val();
        var input = $input = $('<input type="text" name="booking_id" hidden/>').val(booking_id);
        $('#viewBooking').append(input);
        $.ajax({
            type: "POST",
            url: "/updateBooking/",
            dataType: "html",
            data: $('#viewBooking').serialize(),
            success: function(data) {
                $('#showUpdateBKModal').html(data);
                $('#updatedBKModal').modal('show');
            },
        });
        return false;
    });

    $('#changeDuration').click(function() {
        $('input[name=duration]').attr("readonly", false);
    });

    $('#changeDateTime').click(function() {
        $('#additionalFields').append(getTemplate("Date","date"));
        $('#additionalFields').append(getTemplate("Start Time","start_time"));
        $('#additionalFields').append(getTemplate("End Time","end_time"));
        $.ajax({
            type: "GET",
            url: "/getBKDateTime/",
            dataType: "json",
            data: {booking_id: $('input[name=booking_id]').val()},
            success: function(data){
                $('input[name=start_time]').val(data.start_time);
                $('input[name=date]').val(data.date);
                $('input[name=end_time]').val(data.end_time);
            },
        });
    });

    function getTemplate(name,id){
        var div = $('<div class="form-group has-feedback">');
        var label = $('<label for=' + name + ' class="col-sm-2 control-label">' + name + '</label>');
        var input = $('<input>').attr({
            type: 'text',
            class: "form-control",
            id:id,
            name:id,
            value:"{{id}}",
        });
        var div2 = $('<div class="col-sm-10">');
        var span = $('<span class="glyphicon form-control-feedback" id="duration_error"></span>');
        div2.append(input);
        div2.append(span);
        div.append(label);
        div.append(div2);
        return div;
    }

</script>